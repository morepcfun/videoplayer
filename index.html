<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chromebook Video Player</title>
    <meta name="description" content="Online Video Player designed for Chromebooks with up 400% Volume Boost and support for .srt Subtitle Files.">
    <meta name="author" content="Johnny Heggelund">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://morepcfun.github.io/videoplayer/">
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABvElEQVR4AeyXQUsCQRTH366yVmxHiVqjLtLRr6BEhBfxYqAougfPgiDoNxGFFBT6Dl26KHbvUngQhTbq0FFIjOm9g0O2s2DLuguysj9mnLe8/5//4AzKgJ98Pn9RKpUMXddZMplk8Xh8jfF4zKbTqW0SiQSj3qhxn8vlzlCSP2RACgaDD5IkHfPVf07K5TIUi0UOfRe1QI0rRVGes9ns0aouFwqFAyzYFqdGi8WCBg5jjM//TlBrLxQKPWYyGYVqlACNroImzlVVbaKo7IkBFKZHx/RvvDQAgUDg1lMDuBX7nhqgffAN7EYC9XodarUap1qt0vZuhCkBWXA0tFotaLfblgwGAxiNRpzhcMjfbTbpvLH2YjIQDodB07Q1DMOAyWRii9lsBpFIxNKByQD+NgEvDEfBy25zA5ZvbqlgSoB06DaLxWKQTqcdIxqNUmsTQgO0DZVKBVKplGM0Gg2TOC0IDVDBLXwDfgJ+An4ClgkY829wGtHhZmlAu/sApxEa6PV6c7x83kTFba+h7islQH/krlHsHXHtIfHlcnlJBqDb7T51Op0TXFBXwNfnoRP87rHqTSNqnvb7/ZcfAAAA//+UhRssAAAABklEQVQDAB+nmbgHFm2vAAAAAElFTkSuQmCC">
    <style>
        body {
            margin: 0;
            background-color: #0d0d0d;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            color: #f0f0f0;
        }

        #video-player {
            width: 100vw;
            height: 100vh;
            object-fit: contain;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            background-color: #000;
            cursor: pointer;
        }

        .controls-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 1rem 1rem 1rem;
            box-sizing: border-box;
            transition: opacity 0.4s ease-in-out, visibility 0.4s;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
        }

        .controls-container.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .controls-panel {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            width: auto;
            background-color: rgba(30, 30, 30, 0.85);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn {
            font-weight: bold;
            cursor: pointer;
            color: white;
            padding: 12px 18px;
            border: none;
            border-radius: 6px;
            text-align: center;
            transition: background-color 0.2s ease, transform 0.1s ease;
            user-select: none;
        }

        .btn:hover {
            filter: brightness(1.1);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .main-label {
            background-color: #007bff;
        }

        #help-btn {
            background-color: #4a4a4a;
            width: 45px;
            height: 45px;
            padding: 0;
            font-size: 1.2rem;
        }

        input[type="file"] {
            display: none;
        }

        .volume-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-controls label {
            font-size: 1.5rem;
            font-weight: normal;
            cursor: default;
            color: #fff;
        }

        #volume-level {
            font-weight: bold;
            color: #00e0ff;
            margin-left: 8px;
            min-width: 50px;
            text-align: left;
        }

        .volume-slider {
            width: 100px;
        }

        .progress-bar-container {
            width: 100%;
            max-width: 900px;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 15px;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0;
            background-color: #00aaff;
            border-radius: 4px;
        }

        .loop-marker {
            position: absolute;
            top: -3px;
            width: 4px;
            height: 14px;
            background-color: #00e0ff;
            border-radius: 2px;
            transform: translateX(-50%);
            display: none;
        }

        #toast-notification {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 255, 255, 0.85);
            color: #000;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 100;
            font-weight: bold;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s, transform 0.4s, visibility 0.4s;
            pointer-events: none;
        }

        #toast-notification.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-15px);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-box {
            background-color: #1e1e1e;
            padding: 25px 35px;
            border-radius: 12px;
            border: 1px solid #00aaff;
            box-shadow: 0 5px 25px rgba(0, 170, 255, 0.2);
            width: 90%;
            max-width: 400px;
        }

        .modal-box h2 {
            margin-top: 0;
            color: #00aaff;
            text-align: center;
        }

        .modal-box ul {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .modal-box li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .modal-box li:last-child {
            border-bottom: none;
        }

        .modal-box span {
            background-color: #333;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #00e0ff;
        }

        #close-modal-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background-color: #007bff;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <video id="video-player" crossorigin="anonymous" autoplay>
        <track kind="subtitles" srclang="en" label="Subtitles" default>
    </video>

    <div class="controls-container">
        <div class="progress-bar-container" id="progress-bar-container">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
            <div class="loop-marker" id="loop-start-marker"></div>
            <div class="loop-marker" id="loop-end-marker"></div>
        </div>
        <div class="controls-panel">
            <label for="file-upload" class="btn main-label" id="choose-files-btn"></label>
            <input type="file" id="file-upload" accept=".mp4,.mkv,.srt" multiple>
            <div class="volume-controls">
                <label for="volume-booster">üîä<b id="volume-level">100%</b></label>
                <input type="range" id="volume-booster" class="volume-slider" min="1" max="4" step="0.1" value="1" title="Volume Booster">
            </div>
            <button class="btn" id="help-btn">?</button>
        </div>
    </div>

    <div id="toast-notification"></div>

    <div id="shortcuts-modal" class="modal-overlay">
        <div class="modal-box">
            <p>&copy; Johnny Heggelund</p>
            <h2 id="shortcuts-title">Keyboard Shortcuts</h2>
            <ul id="shortcuts-list">
                <li>Play / Pause <span>Space</span></li>
                <li>Toggle Fullscreen <span>F</span></li>
                <li>Toggle Mute <span>M</span></li>
                <li>Seek Forward 5s <span>‚Üí</span></li>
                <li>Seek Backward 5s <span>‚Üê</span></li>
                <li>Loop Control <span>L</span></li>
            </ul>
            <button id="close-modal-btn" class="btn">Close</button>
        </div>
    </div>

    <script>
        /**
         * Language strings for the UI.
         */
        const lang = {
            title: "Chromebook Video Player",
            chooseFiles: "Open Files (.mp4, .mkv, .srt)",
            subtitleLabel: "Subtitles",
            noTrackError: "Could not find a text track on the video element.",
            noVideoOnClipboard: "No video file found on the clipboard.",
            loopStartSet: (time) => `üîÅ Loop start set to ${time}`,
            loopingFromTo: (start, end) => `üîÅ Looping from ${start} to ${end}`,
            invalidLoop: "‚ùå Invalid loop. Reset.",
            loopRemoved: "‚úÖ Loop removed."
        };

        // DOM Element References
        const videoPlayer = document.getElementById('video-player');
        const fileUpload = document.getElementById('file-upload');
        const volumeBooster = document.getElementById('volume-booster');
        const volumeLevel = document.getElementById('volume-level');
        const controlsContainer = document.querySelector('.controls-container');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const loopStartMarker = document.getElementById('loop-start-marker');
        const loopEndMarker = document.getElementById('loop-end-marker');
        const toast = document.getElementById('toast-notification');
        const shortcutsModal = document.getElementById('shortcuts-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const helpBtn = document.getElementById('help-btn');

        // State variables
        let inactivityTimeout;
        let videoUrl = null;
        let audioContext, gainNode;
        let loopStart = null;
        let loopEnd = null;

        /**
         * Updates static UI text elements based on the lang object.
         */
        function updateStaticUIText() {
            document.title = lang.title;
            document.getElementById('choose-files-btn').textContent = lang.chooseFiles;
            const trackElement = videoPlayer.querySelector('track');
            if (trackElement) trackElement.label = lang.subtitleLabel;
        }

        /**
         * Handles the selection of local files (video and/or subtitles).
         * @param {FileList} files - The files selected by the user.
         */
        function handleFiles(files) {
            if (!files || files.length === 0) return;

            const filesArray = Array.from(files);
            const videoFile = filesArray.find(f => f.name.toLowerCase().match(/\.(mp4|mkv)$/));
            const srtFile = filesArray.find(f => f.name.toLowerCase().endsWith('.srt'));

            if (videoFile) {
                if (videoUrl) URL.revokeObjectURL(videoUrl);
                videoUrl = URL.createObjectURL(videoFile);
                videoPlayer.src = videoUrl;
                videoPlayer.load();

                // Automatically look for a matching SRT file
                const videoNameWithoutExt = videoFile.name.split('.').slice(0, -1).join('.');
                const expectedSrtName = `${videoNameWithoutExt.toLowerCase()}.srt`;
                const matchingSrtFile = filesArray.find(f => f.name.toLowerCase() === expectedSrtName);

                if (matchingSrtFile) {
                    loadSrtFile(matchingSrtFile);
                } else if (srtFile) {
                    loadSrtFile(srtFile); // Load any other SRT file provided
                }
            } else if (srtFile) {
                loadSrtFile(srtFile); // Load subtitles for the current video
            }
        }

        /**
         * Loads and processes a .srt subtitle file.
         * @param {File} file - The .srt file.
         */
        function loadSrtFile(file) {
            const track = videoPlayer.textTracks[0];
            if (!track) {
                console.error(lang.noTrackError);
                return;
            }
            track.mode = 'showing';

            const reader = new FileReader();
            reader.onload = (e) => {
                parseSrtAndAddCues(e.target.result, track);
            };
            reader.readAsText(file, 'UTF-8');
        }

        /**
         * Parses SRT content and adds it as VTTCues to a text track.
         * @param {string} srtContent - The raw string content of the SRT file.
         * @param {TextTrack} track - The text track to add cues to.
         */
        function parseSrtAndAddCues(srtContent, track) {
            // Clear any existing cues
            while (track.cues && track.cues.length > 0) {
                track.removeCue(track.cues[0]);
            }

            const cleanContent = srtContent.replace(/\r\n|\r/g, '\n').replace(/^\uFEFF/, ''); // Normalize line endings and remove BOM
            const blocks = cleanContent.split('\n\n');

            for (const block of blocks) {
                const trimmedBlock = block.trim();
                if (!trimmedBlock) continue;

                const lines = trimmedBlock.split('\n');
                if (lines.length < 2) continue;

                const timestampLine = lines.find(line => line.includes('-->'));
                if (!timestampLine) continue;

                const timeMatch = timestampLine.match(/(\d{2}:\d{2}:\d{2}[,.]\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2}[,.]\d{3})/);
                if (!timeMatch) continue;

                const startTime = timeStringToSeconds(timeMatch[1]);
                const endTime = timeStringToSeconds(timeMatch[2]);
                const cueText = lines.slice(lines.indexOf(timestampLine) + 1).join('\n');

                if (!isNaN(startTime) && !isNaN(endTime) && cueText) {
                    const cue = new VTTCue(startTime, endTime, cueText);
                    track.addCue(cue);
                }
            }
        }

        /**
         * Converts an SRT time string (HH:MM:SS,ms) to seconds.
         * @param {string} timeString - The timestamp string from the SRT file.
         * @returns {number} - The time in seconds.
         */
        function timeStringToSeconds(timeString) {
            const [hms, ms] = timeString.replace(',', '.').split('.');
            const parts = hms.split(':');
            if (parts.length !== 3) return NaN;
            return parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]) + (parseInt(ms) / 1000);
        }

        /**
         * Sets up the Web Audio API for volume boosting.
         */
        function setupAudioBooster() {
            if (audioContext) return; // Initialize only once
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContext();
                const source = audioContext.createMediaElementSource(videoPlayer);
                gainNode = audioContext.createGain();
                source.connect(gainNode);
                gainNode.connect(audioContext.destination);
                gainNode.gain.value = parseFloat(volumeBooster.value);
            } catch (e) {
                console.error("Could not create AudioContext:", e);
                volumeBooster.disabled = true;
            }
        }

        /**
         * Shows the control panel and starts a timer to hide it again.
         */
        function showControls() {
            controlsContainer.classList.remove('hidden');
            document.body.style.cursor = 'default';
            clearTimeout(inactivityTimeout);
            inactivityTimeout = setTimeout(hideControls, 3000);
        }

        /**
         * Hides the control panel if the video is playing and the mouse is not over it.
         */
        function hideControls() {
            if (!videoPlayer.paused && !controlsContainer.matches(':hover')) {
                controlsContainer.classList.add('hidden');
                document.body.style.cursor = 'none';
            }
        }

        /**
         * Displays a toast notification with a message.
         * @param {string} message - The message to display.
         */
        function showToast(message) {
            if (!toast) return;
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        /**
         * Formats seconds into an HH:MM:SS string.
         * @param {number} seconds - The number of seconds.
         * @returns {string} The formatted time string.
         */
        function formatTime(seconds) {
            if (isNaN(seconds)) return "00:00:00";
            return new Date(seconds * 1000).toISOString().substr(11, 8);
        }

        /**
         * Handles the logic for setting/removing loop points.
         * Press 1: Sets the start point.
         * Press 2: Sets the end point and starts the loop.
         * Press 3: Clears the loop.
         */
        function handleLoopKey() {
            if (loopStart === null) {
                loopStart = videoPlayer.currentTime;
                showToast(lang.loopStartSet(formatTime(loopStart)));
            } else if (loopEnd === null) {
                loopEnd = videoPlayer.currentTime;
                if (loopEnd <= loopStart) {
                    loopStart = null;
                    loopEnd = null;
                    showToast(lang.invalidLoop);
                } else {
                    showToast(lang.loopingFromTo(formatTime(loopStart), formatTime(loopEnd)));
                    videoPlayer.currentTime = loopStart;
                }
            } else {
                loopStart = null;
                loopEnd = null;
                showToast(lang.loopRemoved);
            }
            updateLoopMarkers();
        }

        /**
         * Updates the position of the loop markers on the progress bar.
         */
        function updateLoopMarkers() {
            const duration = videoPlayer.duration;
            if (loopStart !== null && duration > 0) {
                loopStartMarker.style.left = `${(loopStart / duration) * 100}%`;
                loopStartMarker.style.display = 'block';
            } else {
                loopStartMarker.style.display = 'none';
            }
            if (loopEnd !== null && duration > 0) {
                loopEndMarker.style.left = `${(loopEnd / duration) * 100}%`;
                loopEndMarker.style.display = 'block';
            } else {
                loopEndMarker.style.display = 'none';
            }
        }
        
        /** Shows the shortcuts modal. */
        function showShortcuts() {
            shortcutsModal.style.display = 'flex';
        }

        /** Hides the shortcuts modal. */
        function hideShortcuts() {
            shortcutsModal.style.display = 'none';
        }

        // --- Event Listeners ---

        // File handling
        fileUpload.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            e.target.value = null; // Reset input for same-file selection
        });

        document.body.addEventListener('dragover', (e) => e.preventDefault());
        document.body.addEventListener('drop', (e) => {
            e.preventDefault();
            handleFiles(e.dataTransfer.files);
        });

        document.addEventListener('paste', (e) => {
            e.preventDefault();
            const items = e.clipboardData.items;
            let fileFound = false;
            for (const item of items) {
                if (item.kind === 'file') {
                    const file = item.getAsFile();
                    if (file) {
                        handleFiles([file]);
                        fileFound = true;
                        break;
                    }
                }
            }
            if (!fileFound) {
                showToast(lang.noVideoOnClipboard);
            }
        });

        // Volume booster
        volumeBooster.addEventListener('input', (e) => {
            if (!gainNode) setupAudioBooster(); // Lazy setup on first use
            if (gainNode) {
                const boostValue = parseFloat(e.target.value);
                gainNode.gain.setValueAtTime(boostValue, audioContext.currentTime);
                volumeLevel.textContent = `${Math.round(boostValue * 100)}%`;
            }
        });

        // Player controls visibility
        videoPlayer.addEventListener('play', showControls);
        videoPlayer.addEventListener('pause', showControls);
        videoPlayer.addEventListener('mouseenter', showControls);
        controlsContainer.addEventListener('mouseenter', showControls);
        document.addEventListener('mousemove', showControls);
        videoPlayer.addEventListener('click', () => videoPlayer.paused ? videoPlayer.play() : videoPlayer.pause());

        // Player time and progress update
        videoPlayer.addEventListener('timeupdate', () => {
            // Handle looping
            if (loopStart !== null && loopEnd !== null) {
                if (videoPlayer.currentTime >= loopEnd || videoPlayer.currentTime < loopStart) {
                    videoPlayer.currentTime = loopStart;
                }
            }
            // Update progress bar
            if (videoPlayer.duration) {
                const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
                progressBarFill.style.width = `${progress}%`;
            }
        });

        videoPlayer.addEventListener('loadedmetadata', updateLoopMarkers);

        // Progress bar seeking
        progressBarContainer.addEventListener('click', (e) => {
            const rect = progressBarContainer.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            videoPlayer.currentTime = pos * videoPlayer.duration;
        });

        // Modal visibility
        helpBtn.addEventListener('click', showShortcuts);
        closeModalBtn.addEventListener('click', hideShortcuts);
        shortcutsModal.addEventListener('click', (e) => {
            if (e.target === shortcutsModal) hideShortcuts(); // Close if clicking on overlay
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Always allow Esc to close the modal
            if (e.key === 'Escape') {
                hideShortcuts();
            }

            // Don't trigger shortcuts if the modal is open or if typing in an input field
            if (shortcutsModal.style.display === 'flex' || e.target.tagName === 'INPUT' && e.target.type !== 'range') {
                return;
            }

            // Prevent seeking while volume slider is focused
            if (document.activeElement === volumeBooster && (e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
                return;
            }

            switch (e.key.toLowerCase()) {
                case ' ':
                    // Prevent page scroll when toggling playback
                    if (document.activeElement.tagName !== 'BUTTON') {
                        e.preventDefault();
                        videoPlayer.paused ? videoPlayer.play() : videoPlayer.pause();
                    }
                    break;
                case 'f':
                    document.fullscreenElement ? document.exitFullscreen() : document.documentElement.requestFullscreen();
                    break;
                case 'm':
                    videoPlayer.muted = !videoPlayer.muted;
                    break;
                case 'arrowright':
                    videoPlayer.currentTime += 5;
                    break;
                case 'arrowleft':
                    videoPlayer.currentTime -= 5;
                    break;
                case 'l':
                    handleLoopKey();
                    break;
            }
        });

        // --- Initial Setup ---
        updateStaticUIText();
        showControls();
        hideShortcuts();
    </script>
</body>
</html>
